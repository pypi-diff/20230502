# Comparing `tmp/earthmover-0.1.1-py3-none-any.whl.zip` & `tmp/earthmover-0.1.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,18 +1,18 @@
-Zip file size: 64222 bytes, number of entries: 49
--rwxrwxrwx  2.0 unx        5 b- defN 23-Mar-27 21:04 earthmover/VERSION.txt
+Zip file size: 64228 bytes, number of entries: 49
+-rwxrwxrwx  2.0 unx        5 b- defN 23-May-02 19:33 earthmover/VERSION.txt
 -rw-r--r--  2.0 unx        2 b- defN 22-Sep-15 19:37 earthmover/__init__.py
 -rw-r--r--  2.0 unx     6141 b- defN 23-Mar-27 21:09 earthmover/__main__.py
--rw-r--r--  2.0 unx    18257 b- defN 23-Mar-27 21:00 earthmover/earthmover.py
+-rw-r--r--  2.0 unx    18269 b- defN 23-May-02 19:29 earthmover/earthmover.py
 -rw-r--r--  2.0 unx     3108 b- defN 23-Mar-23 13:31 earthmover/error_handler.py
 -rw-r--r--  2.0 unx     9179 b- defN 23-Mar-23 13:31 earthmover/graph.py
 -rw-r--r--  2.0 unx     4433 b- defN 23-Mar-22 20:54 earthmover/node.py
 -rw-r--r--  2.0 unx     8120 b- defN 22-Sep-15 20:14 earthmover/runs_file.py
 -rw-r--r--  2.0 unx     3395 b- defN 23-Mar-22 20:54 earthmover/util.py
--rw-r--r--  2.0 unx     1491 b- defN 23-Mar-22 20:54 earthmover/yaml_parser.py
+-rw-r--r--  2.0 unx     1491 b- defN 23-Apr-26 14:48 earthmover/yaml_parser.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-15 19:41 earthmover/nodes/__init__.py
 -rw-r--r--  2.0 unx     4243 b- defN 23-Feb-17 19:32 earthmover/nodes/destination.py
 -rw-r--r--  2.0 unx     3957 b- defN 23-Mar-22 20:54 earthmover/nodes/operation.py
 -rw-r--r--  2.0 unx    12577 b- defN 23-Feb-17 18:03 earthmover/nodes/source.py
 -rw-r--r--  2.0 unx     1881 b- defN 23-Mar-22 20:54 earthmover/nodes/transformation.py
 -rw-r--r--  2.0 unx        0 b- defN 22-Sep-15 19:41 earthmover/operations/__init__.py
 -rw-r--r--  2.0 unx    14682 b- defN 23-Mar-22 20:54 earthmover/operations/column.py
@@ -22,30 +22,30 @@
 -rwxrwxrwx  2.0 unx     8773 b- defN 23-Mar-22 20:54 earthmover/tests/earthmover.yaml
 -rwxrwxrwx  2.0 unx     7571 b- defN 22-Sep-16 13:53 earthmover/tests/expected/animals.jsonl
 -rwxrwxrwx  2.0 unx      434 b- defN 22-Sep-16 13:32 earthmover/tests/expected/big_cats.jsonl
 -rwxrwxrwx  2.0 unx      406 b- defN 22-Sep-16 13:32 earthmover/tests/expected/species_count_by_zoo.jsonl
 -rwxrwxrwx  2.0 unx      821 b- defN 22-Sep-16 13:35 earthmover/tests/expected/total_of_each_species.jsonl
 -rwxrwxrwx  2.0 unx      797 b- defN 22-Sep-16 13:32 earthmover/tests/expected/zoo_count_by_species.jsonl
 -rwxrwxrwx  2.0 unx      280 b- defN 22-Sep-16 13:32 earthmover/tests/expected/zoo_count_by_year_founded.jsonl
--rwxrwxrwx  2.0 unx     7571 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/animals.jsonl
--rwxrwxrwx  2.0 unx      434 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/big_cats.jsonl
--rwxrwxrwx  2.0 unx      406 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/species_count_by_zoo.jsonl
--rwxrwxrwx  2.0 unx      821 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/total_of_each_species.jsonl
--rwxrwxrwx  2.0 unx      797 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/zoo_count_by_species.jsonl
--rwxrwxrwx  2.0 unx      280 b- defN 23-Mar-23 13:31 earthmover/tests/outputs/zoo_count_by_year_founded.jsonl
+-rwxrwxrwx  2.0 unx     7571 b- defN 23-May-02 19:29 earthmover/tests/outputs/animals.jsonl
+-rwxrwxrwx  2.0 unx      434 b- defN 23-May-02 19:29 earthmover/tests/outputs/big_cats.jsonl
+-rwxrwxrwx  2.0 unx      406 b- defN 23-May-02 19:29 earthmover/tests/outputs/species_count_by_zoo.jsonl
+-rwxrwxrwx  2.0 unx      821 b- defN 23-May-02 19:29 earthmover/tests/outputs/total_of_each_species.jsonl
+-rwxrwxrwx  2.0 unx      797 b- defN 23-May-02 19:29 earthmover/tests/outputs/zoo_count_by_species.jsonl
+-rwxrwxrwx  2.0 unx      280 b- defN 23-May-02 19:29 earthmover/tests/outputs/zoo_count_by_year_founded.jsonl
 -rwxrwxrwx  2.0 unx      712 b- defN 22-Sep-16 15:38 earthmover/tests/sources/birds.csv
 -rwxrwxrwx  2.0 unx      422 b- defN 22-May-24 21:36 earthmover/tests/sources/fishes.csv
 -rwxrwxrwx  2.0 unx      156 b- defN 22-May-24 21:14 earthmover/tests/sources/inventories.csv
 -rwxrwxrwx  2.0 unx      930 b- defN 22-May-24 21:06 earthmover/tests/sources/mammals.csv
 -rwxrwxrwx  2.0 unx      478 b- defN 22-May-24 21:06 earthmover/tests/sources/reptiles.csv
 -rwxrwxrwx  2.0 unx      284 b- defN 22-May-25 14:00 earthmover/tests/sources/zoos.csv
 -rwxrwxrwx  2.0 unx      215 b- defN 22-Jul-14 20:55 earthmover/tests/templates/animal.jsont
 -rwxrwxrwx  2.0 unx      184 b- defN 22-May-24 21:33 earthmover/tests/templates/cats.jsont
 -rwxrwxrwx  2.0 unx       93 b- defN 22-Jun-20 13:40 earthmover/tests/templates/count.jsont
--rwxrwxrwx  2.0 unx    11349 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/LICENSE
--rw-r--r--  2.0 unx    43830 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/WHEEL
--rwxrwxrwx  2.0 unx      135 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/dependency_links.txt
--rwxrwxrwx  2.0 unx       56 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/entry_points.txt
--rwxrwxrwx  2.0 unx       11 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     4436 b- defN 23-Mar-27 21:19 earthmover-0.1.1.dist-info/RECORD
-49 files, 203468 bytes uncompressed, 57014 bytes compressed:  72.0%
+-rwxrwxrwx  2.0 unx    11349 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/LICENSE
+-rw-r--r--  2.0 unx    43830 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/WHEEL
+-rwxrwxrwx  2.0 unx      135 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/dependency_links.txt
+-rwxrwxrwx  2.0 unx       56 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/entry_points.txt
+-rwxrwxrwx  2.0 unx       11 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     4436 b- defN 23-May-02 19:39 earthmover-0.1.2.dist-info/RECORD
+49 files, 203480 bytes uncompressed, 57020 bytes compressed:  72.0%
```

## zipnote {}

```diff
@@ -120,29 +120,29 @@
 
 Filename: earthmover/tests/templates/cats.jsont
 Comment: 
 
 Filename: earthmover/tests/templates/count.jsont
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/LICENSE
+Filename: earthmover-0.1.2.dist-info/LICENSE
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/METADATA
+Filename: earthmover-0.1.2.dist-info/METADATA
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/WHEEL
+Filename: earthmover-0.1.2.dist-info/WHEEL
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/dependency_links.txt
+Filename: earthmover-0.1.2.dist-info/dependency_links.txt
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/entry_points.txt
+Filename: earthmover-0.1.2.dist-info/entry_points.txt
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/top_level.txt
+Filename: earthmover-0.1.2.dist-info/top_level.txt
 Comment: 
 
-Filename: earthmover-0.1.1.dist-info/RECORD
+Filename: earthmover-0.1.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## earthmover/VERSION.txt

```diff
@@ -1 +1 @@
-0.1.1
+0.1.2
```

## earthmover/earthmover.py

```diff
@@ -5,14 +5,15 @@
 import os
 import string
 import time
 import yaml
 import jinja2
 import pandas as pd
 
+from string import Template
 from typing import Optional
 
 from earthmover.error_handler import ErrorHandler
 from earthmover.graph import Graph
 from earthmover.runs_file import RunsFile
 from earthmover.nodes.destination import Destination
 from earthmover.nodes.source import Source
@@ -120,80 +121,81 @@
             # Read the configs block and extract the (optional) macros field.
             if start is not None and end is not None:
                 configs_pass1 = yaml.safe_load("".join(lines[start:end]))
                 self.macros = configs_pass1.get("config", {}).get("macros", "")
             else:
                 configs_pass1 = {}
 
+            # Figure out lines range of macro definitions, to skip (re)reading/parsing them later
             self.macros_lines = self.macros.count("\n")
+            macros_definitions = [i for i, x in enumerate(lines) if x.strip().startswith('macros:')]
 
 
         # pass 2:
-        #   (a) load template YAML
+        #   (a) load template YAML minus macros (which were already loaded in pass 1)
         #   (b) replace envvars
         #   (c) render Jinja in YAML template
         #   (d) load YAML to config Dict
-        with open(self.config_file, "r") as stream:
-            
-            # (a)
-            self.config_template_string = stream.read()
-
-            # (b)
-            _env_backup = os.environ.copy() # backup envvars
-            os.environ.update(self.params) # override with CLI params
-
-            for k, v in configs_pass1.get("config", {}).get("parameter_defaults", {}).items():
-                if isinstance(v, str):
-                    os.environ.setdefault(k, v)  # set defaults, if any
-                else:
-                    self.error_handler.throw(
-                        f"YAML config.parameter_defaults.{k} must be a string"
-                    )
-                    raise
-
-            # It's necessary to expandvars() on each line separately (rather than on the
-            # whole file in one go) to avoid problems on Windows with YAML files that contain
-            # anchors (&example)... an unfortunate Windows Python bug.
-            self.config_template_string = "\n".join([os.path.expandvars(x)
-                                                        for x in self.config_template_string.split("\n")])
-            os.environ = _env_backup # restore envvars
-            
-            # (c)
-            try:
-                self.config_template = jinja2.Environment(
-                    loader=jinja2.FileSystemLoader(os.path.dirname('./'))
-                ).from_string(self.macros + self.config_template_string)
-
-                self.config_yaml = self.config_template.render()
-
-            except Exception as err:
-                lineno = util.jinja2_template_error_lineno()
-                if lineno:
-                    lineno = ", near line " + str(lineno - self.macros_lines - 1)
-                self.error_handler.throw(
-                    f"Jinja syntax error in YAML configuration template{lineno} ({err})"
-                )
-                raise
 
-            # (d)
-            try:
-                configs_pass2 = yaml.load(self.config_yaml, Loader=SafeLineEnvVarLoader)
-                configs_pass2.get("config", {}).update({"macros": self.macros})
-            except yaml.YAMLError as err:
-                linear_err = " ".join([line.replace("^", "").strip() for line in str(err).split("\n")])
+        # (a)
+        if len(macros_definitions)>0:
+            self.config_template_string = "".join(lines[:macros_definitions[0]] + lines[macros_definitions[0] + self.macros_lines + 1:])
+        else:
+            self.config_template_string = "".join(lines)
+
+        # (b)
+        _env_backup = os.environ.copy() # backup envvars
+        os.environ.update(self.params) # override with CLI params
+
+        for k, v in configs_pass1.get("config", {}).get("parameter_defaults", {}).items():
+            if isinstance(v, str):
+                os.environ.setdefault(k, v)  # set defaults, if any
+            else:
                 self.error_handler.throw(
-                    f"YAML could not be parsed: {linear_err}"
+                    f"YAML config.parameter_defaults.{k} must be a string"
                 )
                 raise
-        
+
+        self.config_template_string = Template(self.config_template_string).safe_substitute(os.environ)
+        os.environ = _env_backup # restore envvars
+
         # Uncomment the following to view original template yaml and parsed yaml:
-        # with open("./earthmover_yaml.yml", "w") as f:
-        #     f.write(self.config_yaml)
         # with open("./earthmover_template.yml", "w") as f:
         #     f.write(self.config_template_string)
+        
+        # (c)
+        try:
+            self.config_template = jinja2.Environment(
+                loader=jinja2.FileSystemLoader(os.path.dirname('./'))
+            ).from_string(self.macros + self.config_template_string)
+
+            self.config_yaml = self.config_template.render()
+            # Uncomment the following to view original template yaml and parsed yaml:
+            # with open("./earthmover_yaml.yml", "w") as f:
+            #     f.write(self.config_yaml)
+    
+        except Exception as err:
+            lineno = util.jinja2_template_error_lineno()
+            if lineno:
+                lineno = ", near line " + str(lineno - self.macros_lines - 1)
+            self.error_handler.throw(
+                f"Jinja syntax error in YAML configuration template{lineno} ({err})"
+            )
+            raise
+
+        # (d)
+        try:
+            configs_pass2 = yaml.load(self.config_yaml, Loader=SafeLineEnvVarLoader)
+            configs_pass2.get("config", {}).update({"macros": self.macros})
+        except yaml.YAMLError as err:
+            linear_err = " ".join([line.replace("^", "").strip() for line in str(err).split("\n")])
+            self.error_handler.throw(
+                f"YAML could not be parsed: {linear_err}"
+            )
+            raise
 
         return configs_pass2
 
     
     def build_graph(self):
         """
```

## Comparing `earthmover-0.1.1.dist-info/LICENSE` & `earthmover-0.1.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `earthmover-0.1.1.dist-info/METADATA` & `earthmover-0.1.2.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: earthmover
-Version: 0.1.1
+Version: 0.1.2
 Summary: Transforms tabular data sources into text-based data via YAML configuration
 Home-page: https://github.com/edanalytics/earthmover
 Download-URL: https://github.com/edanalytics/earthmover/archive/refs/tags/v0.0.4.tar.gz
 Author: Tom Reitz, Jay Kaiser
 Author-email: treitz@edanalytics.org, jkaiser@edanalytics.org
 License: Apache 2.0
 Classifier: Development Status :: 4 - Beta
```

## Comparing `earthmover-0.1.1.dist-info/RECORD` & `earthmover-0.1.2.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,11 +1,11 @@
-earthmover/VERSION.txt,sha256=Ee4juPwvxhnW6rYnettaUnJhBnrAHM_D4RhX9Vvxi80,5
+earthmover/VERSION.txt,sha256=VKRsZExOtvEo-Z9_CENJGGF7MbaAUi7UrLV8lCQ3KCc,5
 earthmover/__init__.py,sha256=frcCV1k9oG9oKj3dpUqdJg1PxRT2RSN_XKdLCPjaYaY,2
 earthmover/__main__.py,sha256=RZdMZHTOGMYCavNusosYtA99JjEZqtyfS3XhwHH8Nik,6141
-earthmover/earthmover.py,sha256=1VJrR7UCltX0tvviy6BOp119Q259-H3w39JGwcwkyMM,18257
+earthmover/earthmover.py,sha256=7h3v0WV3Lpz0zOZryO4x8wcjcTb9p10brauKAzJbKBk,18269
 earthmover/error_handler.py,sha256=Dho3WOlJYrXDUBEoB8BUK4x_VSsG1HA_Q6GZhg7W2O4,3108
 earthmover/graph.py,sha256=Jty1IDu3tNrl-6FUlEoXZ5aq2RDxF89rDRAU9WHGLHI,9179
 earthmover/node.py,sha256=yqDuKUtQ9BPX2_LInbZodNlNOrOJRzYa6d5PbRUZxUo,4433
 earthmover/runs_file.py,sha256=dpEghSUBWr52PVoYTgWTWGK-cbaoTv3BJ4GvtqVhveg,8120
 earthmover/util.py,sha256=hf2PFgUZykqRMI8A2KbwH21KlTlXyRYOc88PcGL_Rps,3395
 earthmover/yaml_parser.py,sha256=eLWj79ZTg4VsWlooOUQDr42-aAcE8ddPD_xjWuqQvSw,1491
 earthmover/nodes/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -36,14 +36,14 @@
 earthmover/tests/sources/inventories.csv,sha256=5fERQS45u7YSg0fW35QvnHUbYThwYdWW5KDVQoHHRss,156
 earthmover/tests/sources/mammals.csv,sha256=7zsmutOUCEBvEmCHdaBOIgMiRKBNA46p3V-rBWShjJc,930
 earthmover/tests/sources/reptiles.csv,sha256=HE5LXBv2zwfS_Ccbx5UFzG-FGwCUAaHGDUoQ949tAtY,478
 earthmover/tests/sources/zoos.csv,sha256=qHchJkWezmCKL7Wu82Mlhhpc9YyB0LqzyGtquS5fYjM,284
 earthmover/tests/templates/animal.jsont,sha256=WVANYqoyPAysz2eFjIgftCk9XbN_7bM-Dr1awGSIxwM,215
 earthmover/tests/templates/cats.jsont,sha256=drWhdwDPwv_mDqvYbHJgVRODGkt7iq5yGYQguSmFfTc,184
 earthmover/tests/templates/count.jsont,sha256=CRmgEGZ0PYfyTfT0_bnSZvap9lst8SKUrDBtn51r-fo,93
-earthmover-0.1.1.dist-info/LICENSE,sha256=QoIB1PHNf6dGs6i0VkXumtNelR-vv2rfNMAHMnlaIDw,11349
-earthmover-0.1.1.dist-info/METADATA,sha256=pHc3JHSYaJEb1Darh7kM-tbT1t4ZCEpKyCyVDyJdWRw,43830
-earthmover-0.1.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-earthmover-0.1.1.dist-info/dependency_links.txt,sha256=zUjtOVgogWsGh-RNRqXTvs-OUh-L6P7e4OmQNBt6iWU,135
-earthmover-0.1.1.dist-info/entry_points.txt,sha256=3Tx8TE2CCFvNikmltqOCkCLlLmlf3x7P51PxpNrPOOQ,56
-earthmover-0.1.1.dist-info/top_level.txt,sha256=M55nBRq8JtBFEJcnqz1GpG8EtnXFHeWJ38QIFp0N26Q,11
-earthmover-0.1.1.dist-info/RECORD,,
+earthmover-0.1.2.dist-info/LICENSE,sha256=QoIB1PHNf6dGs6i0VkXumtNelR-vv2rfNMAHMnlaIDw,11349
+earthmover-0.1.2.dist-info/METADATA,sha256=gYcAAEQ6i9iqXyfNCtPov_VK6ct0hz-HJjSNAho2xRY,43830
+earthmover-0.1.2.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+earthmover-0.1.2.dist-info/dependency_links.txt,sha256=zUjtOVgogWsGh-RNRqXTvs-OUh-L6P7e4OmQNBt6iWU,135
+earthmover-0.1.2.dist-info/entry_points.txt,sha256=3Tx8TE2CCFvNikmltqOCkCLlLmlf3x7P51PxpNrPOOQ,56
+earthmover-0.1.2.dist-info/top_level.txt,sha256=M55nBRq8JtBFEJcnqz1GpG8EtnXFHeWJ38QIFp0N26Q,11
+earthmover-0.1.2.dist-info/RECORD,,
```

