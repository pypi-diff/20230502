# Comparing `tmp/miniagent-0.0.5-py3-none-any.whl.zip` & `tmp/miniagent-0.0.6-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,20 +1,20 @@
-Zip file size: 12453 bytes, number of entries: 18
+Zip file size: 13280 bytes, number of entries: 18
 -rw-rw-r--  2.0 unx        0 b- defN 23-Apr-29 08:47 miniadmin/__init__.py
 -rw-rw-r--  2.0 unx     2440 b- defN 23-Apr-29 08:47 miniadmin/admin.py
--rw-rw-r--  2.0 unx     2556 b- defN 23-Apr-29 09:24 miniagent/__init__.py
--rw-rw-r--  2.0 unx     1958 b- defN 23-Apr-29 08:47 miniagent/adapter.py
--rw-rw-r--  2.0 unx     3296 b- defN 23-Apr-29 08:47 miniagent/app_config.py
--rw-rw-r--  2.0 unx     1540 b- defN 23-Apr-29 08:47 miniagent/command_reciever.py
--rw-rw-r--  2.0 unx      863 b- defN 23-Apr-29 08:47 miniagent/common.py
--rw-rw-r--  2.0 unx      791 b- defN 23-Apr-29 08:47 miniagent/event_reciever.py
--rw-rw-r--  2.0 unx     3389 b- defN 23-Apr-29 08:47 miniagent/executer.py
--rw-rw-r--  2.0 unx      528 b- defN 23-Apr-29 08:47 miniagent/job_reciever.py
--rw-rw-r--  2.0 unx     2216 b- defN 23-Apr-29 08:47 miniagent/message_reciever.py
--rw-rw-r--  2.0 unx      275 b- defN 23-Apr-29 08:47 miniagent/models.py
--rw-rw-r--  2.0 unx     1063 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/LICENSE
--rw-rw-r--  2.0 unx     2328 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/WHEEL
--rw-rw-r--  2.0 unx       71 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       20 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     1442 b- defN 23-Apr-29 09:25 miniagent-0.0.5.dist-info/RECORD
-18 files, 24868 bytes uncompressed, 10097 bytes compressed:  59.4%
+-rw-rw-r--  2.0 unx     2925 b- defN 23-May-01 23:47 miniagent/__init__.py
+-rw-rw-r--  2.0 unx     1958 b- defN 23-May-01 23:47 miniagent/adapter.py
+-rw-rw-r--  2.0 unx     3296 b- defN 23-May-01 23:47 miniagent/app_config.py
+-rw-rw-r--  2.0 unx     1405 b- defN 23-May-01 23:47 miniagent/command_reciever.py
+-rw-rw-r--  2.0 unx      863 b- defN 23-May-01 23:47 miniagent/common.py
+-rw-rw-r--  2.0 unx      791 b- defN 23-May-01 23:47 miniagent/event_reciever.py
+-rw-rw-r--  2.0 unx     3389 b- defN 23-May-01 23:47 miniagent/executer.py
+-rw-rw-r--  2.0 unx      528 b- defN 23-May-01 23:47 miniagent/job_reciever.py
+-rw-rw-r--  2.0 unx     2452 b- defN 23-May-01 23:47 miniagent/message_reciever.py
+-rw-rw-r--  2.0 unx      275 b- defN 23-May-01 23:47 miniagent/models.py
+-rw-rw-r--  2.0 unx     1063 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/LICENSE
+-rw-rw-r--  2.0 unx     4078 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       71 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       20 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     1442 b- defN 23-May-01 23:49 miniagent-0.0.6.dist-info/RECORD
+18 files, 27088 bytes uncompressed, 10924 bytes compressed:  59.7%
```

## zipnote {}

```diff
@@ -30,26 +30,26 @@
 
 Filename: miniagent/message_reciever.py
 Comment: 
 
 Filename: miniagent/models.py
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/LICENSE
+Filename: miniagent-0.0.6.dist-info/LICENSE
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/METADATA
+Filename: miniagent-0.0.6.dist-info/METADATA
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/WHEEL
+Filename: miniagent-0.0.6.dist-info/WHEEL
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/entry_points.txt
+Filename: miniagent-0.0.6.dist-info/entry_points.txt
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/top_level.txt
+Filename: miniagent-0.0.6.dist-info/top_level.txt
 Comment: 
 
-Filename: miniagent-0.0.5.dist-info/RECORD
+Filename: miniagent-0.0.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## miniagent/__init__.py

```diff
@@ -1,8 +1,12 @@
 import os
+import sys
+import signal
+import threading
+from time import sleep
 from importlib import import_module
 from flask import Flask
 from flask_cors import CORS
 from flask_restful import Api
 from flask_apscheduler import APScheduler
 from flask_sqlalchemy import SQLAlchemy
 import logging
@@ -10,15 +14,15 @@
 from datetime import datetime
 from .app_config import AppConfig
 from .executer import ExecuterCaller
 from .command_reciever import CommandsReciever
 from .event_reciever import Command
 from .message_reciever import MessageReciever
 
-__version__ = '0.0.5'
+__version__ = '0.0.6'
 
 #Load configuration
 configure = AppConfig(os.getcwd())
 configure.from_pyfile('config.py')
 
 #Set logging
 """
@@ -59,18 +63,30 @@
 scheduler = APScheduler()
 scheduler.init_app(app)
 scheduler.start()
 
 #Executer
 executer = ExecuterCaller.instance(configure)
 
+#Interept Event
+stop_event = threading.Event()
+
+def signal_handler(sig, frame):
+    global stop_event
+    stop_event.set()
+    sys.stderr.write("KeyboardInterrupt received, stopping...\n")
+    sleep(5)
+    sys.exit(0)
+
+signal.signal(signal.SIGINT, signal_handler)
+
 #Command Reciever (Web url polling)
 command_reciever = None
 if configure.get('COMMANDER_SERVER_URL'):
-    command_reciever = CommandsReciever(configure['COMMANDER_SERVER_URL'])
+    command_reciever = CommandsReciever(configure['COMMANDER_SERVER_URL'], stop_event)
 
 #Table creation
 from . import models
 if configure.get('CUSTOM_MODELS_PATH'):
     mdl = import_module(configure['CUSTOM_MODELS_PATH'])
     cls_objs = [x for x in mdl.__dict__ if not x.startswith("_")]
     globals().update({k: getattr(mdl, k) for k in cls_objs})
@@ -79,15 +95,15 @@
     db.create_all()
 
 #Kafka
 message_reciever = None
 if configure.get('EXECUTERS_BY_TOPIC') and configure.get('KAFKA_BOOTSTRAP_SERVERS'):
     message_reciever = MessageReciever(
         group_id = configure['AGENT_NAME'],
-        executers_by_topic = configure['EXECUTERS_BY_TOPIC']
+        executers_by_topic = configure['EXECUTERS_BY_TOPIC'],
+        event = stop_event
     )
 
-
 #Start scheduled jobs
 if configure.get('SCHEDULED_JOBS'):
     from .job_reciever import ScheduledJob
     ScheduledJob(executer, configure['SCHEDULED_JOBS'])
```

## miniagent/command_reciever.py

```diff
@@ -3,51 +3,47 @@
 import threading
 from time import sleep
 from polling2 import *
 from .executer import ExecuterCaller
         
 class CommandsReciever:
 
-    def __init__(self, url: str) -> None:
-        #self.interrupt_event = threading.Event()
-        #self.lock = threading.Lock()
+    def __init__(self, url: str, event: threading.Event) -> None:
+        self.event = event
         self._start_polling(url)
 
     def get_thread(self):
         return self.thread
     
     def _get_response(self, response):
         return response.status_code == 200
 
     def _polling(self, url):
 
         while True:
 
-            """
-            if self.interrupt_event.is_set():
-                print('[interrupted_process 1]')
-                #self.interrupted_process()
-                self.interrupt_event.clear()
+            if self.event.is_set():
+                print('[CommandsReciever is broken]')
                 break
-            """
 
             try:
                 result = poll(lambda: requests.get(url), 
                                 step=10, 
                                 poll_forever=True,
                                 check_success=self._get_response)
             except requests.exceptions.ConnectionError as e:
-                sleep(30)
+                sleep(10)
                 continue
 
             print('result : ',type(result.text), result.text)
             result_dict = json.loads(result.text)
 
             #self.lock.locked()
             rtn, message = ExecuterCaller.instance().execute_command(result_dict)
             #self.lock.release()
 
     def _start_polling(self, url):
 
         self.thread = threading.Thread(target=self._polling, args=(url,))
         self.thread.name = '_polling'
-        self.thread.start()
+        self.thread.start()
+        #self.thread.join()
```

## miniagent/message_reciever.py

```diff
@@ -4,16 +4,17 @@
 import json
 import ast
 from time import sleep
 from .executer import ExecuterCaller
         
 class MessageReciever:
 
-    def __init__(self, group_id: str, executers_by_topic: dict) -> None:
+    def __init__(self, group_id: str, executers_by_topic: dict, event: threading.Event) -> None:
 
+        self.event = event
         self.consumer = None
         try:
             self.consumer = KafkaConsumer(
                                 bootstrap_servers=['localhost:9092'],
                                 auto_offset_reset='earliest',
                                 value_deserializer=lambda m: json.loads(m.decode('utf-8')),
                                 group_id=group_id,
@@ -34,18 +35,22 @@
     def get_thread(self):
         return self.thread
     
     def _polling(self):
 
         while True:
 
+            if self.event.is_set():
+                print('[MessageReciever is broken]')
+                break
+
             try:
                 results = self.consumer.poll(10.0)
             except Exception as e:
-                sleep(20)
+                sleep(10)
                 continue
 
             if not results:
                 sleep(5)
             
             for topic_partition, messages in results.items():
                 print('kafka message : ',type(messages), messages)
@@ -55,20 +60,23 @@
                     rtn, comment = ExecuterCaller.instance().execute_command(result_dict)
 
     def _start_polling(self):
 
         self.thread = threading.Thread(target=self._polling)
         self.thread.name = '_kafka_consumer'
         self.thread.start()
+        #self.thread.join()
 
     def parse_message(self, topic: str, message: dict):
         
         result_dict =\
             dict(
                 executer = self.executers[topic],
                 initial_param = message
             )
         
         return result_dict
     
     def __del__(self):
-        self.consumer.close()
+        #if self.consumer:
+        #    self.consumer.close()
+        pass
```

## Comparing `miniagent-0.0.5.dist-info/LICENSE` & `miniagent-0.0.6.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `miniagent-0.0.5.dist-info/RECORD` & `miniagent-0.0.6.dist-info/RECORD`

 * *Files 21% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 miniadmin/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 miniadmin/admin.py,sha256=MejGCYRC8vHuGFRQ5xaZaVBEpio1FCaFl6xNtSkyD-k,2440
-miniagent/__init__.py,sha256=Qih--0DYmeLi3dQb1Qb75lHy7OHogxSeCXqAlbTWnAo,2556
+miniagent/__init__.py,sha256=9lMtDuYWZ9vCH0V7lUgGh6zKtvxYzzmOFF-2iGdKrBY,2925
 miniagent/adapter.py,sha256=uR-e9a--WaSlxbXHWFKR2Vgc2ITbInDV2io0Cmr5Wjg,1958
 miniagent/app_config.py,sha256=B-K-5ebnUIekZlrDoLdVttGzewTNjCpu6DDVmKqPB2M,3296
-miniagent/command_reciever.py,sha256=NQZbYEKNHovddJ9duKjZ9SKiV-RzhRavJQIvdgH6Q3I,1540
+miniagent/command_reciever.py,sha256=-ICCLyIooeOb4HQuf0wAr3C9TP1dfWfT_CsTPyvCyww,1405
 miniagent/common.py,sha256=mANId-sgxiLYOva-m63hnNud0Cco-JH6JpXrSv74A5Q,863
 miniagent/event_reciever.py,sha256=DJp0TiN_pJ_BnZLfUM_hKks6QDy_OONV_rAmc6aeN-U,791
 miniagent/executer.py,sha256=y4BEMX7NLKgPARbRbNmPEhPuqlhZzgTvEP3N8nm_wC8,3389
 miniagent/job_reciever.py,sha256=xm0lD99RUkPqD3tUzvI0ZcDFgxAwcXwiGCiJHphP0Kw,528
-miniagent/message_reciever.py,sha256=zSheWN9ZSP1J79CUA-SP99cT5uvuWHvyNo5j8AQcTW0,2216
+miniagent/message_reciever.py,sha256=FSTAjhMuV2miXJvoG7PZygY4Wk3I7ywIBGPYjFSwTn8,2452
 miniagent/models.py,sha256=oEWOA0awWmcjo_nm0IVwoY9_FTkssLG6pX-oLYvFnTo,275
-miniagent-0.0.5.dist-info/LICENSE,sha256=nj6HxIMEUT6XKDHjyJYPnIS37d5NKErlNwbV0XbxcsQ,1063
-miniagent-0.0.5.dist-info/METADATA,sha256=sYTcRapaoZ473C6TJDW84jV89Dx2fWKDHhaeH4TPp1s,2328
-miniagent-0.0.5.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-miniagent-0.0.5.dist-info/entry_points.txt,sha256=v6HAev-cy1ey5C3hnCdS589pljKD1wOW6zURhAq5P6Q,71
-miniagent-0.0.5.dist-info/top_level.txt,sha256=AMyT-pye0DyB9Q8Ow_lGVtXb3COCxNZoS0yIdptLgzU,20
-miniagent-0.0.5.dist-info/RECORD,,
+miniagent-0.0.6.dist-info/LICENSE,sha256=nj6HxIMEUT6XKDHjyJYPnIS37d5NKErlNwbV0XbxcsQ,1063
+miniagent-0.0.6.dist-info/METADATA,sha256=W00ywKOo53W8QUcmwjr4TLNjuz9aKeCENXEwhl23th0,4078
+miniagent-0.0.6.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+miniagent-0.0.6.dist-info/entry_points.txt,sha256=v6HAev-cy1ey5C3hnCdS589pljKD1wOW6zURhAq5P6Q,71
+miniagent-0.0.6.dist-info/top_level.txt,sha256=AMyT-pye0DyB9Q8Ow_lGVtXb3COCxNZoS0yIdptLgzU,20
+miniagent-0.0.6.dist-info/RECORD,,
```

